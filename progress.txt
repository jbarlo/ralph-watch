# Ralph Progress Log

## Ticket #1: Init Next.js project with pnpm
- Created Next.js 16 app with App Router, TypeScript, Tailwind, ESLint, pnpm
- Moved project contents from ralph-watch-ui/ subdirectory to workspace root
- Downgraded Tailwind from v4 to v3 due to native binding issues in NixOS environment
- Added tailwind.config.ts, updated postcss.config.mjs and globals.css for Tailwind v3
- Files added: package.json, tsconfig.json, next.config.ts, eslint.config.mjs, postcss.config.mjs, tailwind.config.ts, src/, public/
- Verified: `pnpm build` and `pnpm lint` pass

## Ticket #20: ESLint + Prettier + strict TS + quality check
- Installed prettier, eslint-config-prettier, eslint-plugin-prettier, lodash, @types/lodash
- Created .prettierrc with singleQuote, semi, tabWidth 2
- Updated eslint.config.mjs to extend prettier (flat config format)
- Created .prettierignore to exclude read-only files
- Enabled noUncheckedIndexedAccess in tsconfig.json
- Added scripts: format, lint (updated), typecheck, check
- Ran pnpm format to fix quote styles across codebase
- Files changed: package.json, tsconfig.json, eslint.config.mjs, .prettierrc, .prettierignore
- Verified: `pnpm check` passes (lint + typecheck)

## Ticket #21: Result type utilities for railway-oriented flow
- Created src/lib/result.ts with railway-oriented programming utilities
- Implemented Result<T, E> discriminated union (Ok/Err)
- Added constructor functions: ok(), err()
- Added type guards: isOk(), isErr()
- Added transformations: map(), flatMap(), mapErr()
- Added utilities: unwrapOr(), tryCatch(), tryCatchAsync()
- Files added: src/lib/result.ts
- Verified: `pnpm check` passes

## Ticket #22: Test setup with vitest
- Installed vitest, @testing-library/react, @testing-library/dom, jsdom, @vitejs/plugin-react
- Created vitest.config.ts with jsdom environment and react plugin
- Added scripts: `test` (vitest run), `test:watch` (vitest)
- Updated `check` script to include test: lint + typecheck + test
- Created src/lib/result.test.ts with 16 integration tests for Result utilities
- Files added: vitest.config.ts, src/lib/result.test.ts
- Verified: `pnpm check` passes (all 16 tests pass)

## Ticket #2: Add shadcn/ui and configure
- Initialized shadcn/ui with `pnpm dlx shadcn@latest init` (Neutral color theme)
- Added components: button, card, input, textarea, badge, scroll-area, toast (+ toaster)
- Created components.json config and src/lib/utils.ts (cn utility)
- Created src/hooks/use-toast.ts for toast functionality
- Fixed tailwind.config.ts to use ESM import for tailwindcss-animate
- Fixed eslint warning in use-toast.ts
- Ran pnpm format to fix prettier formatting issues
- Files added: components.json, src/lib/utils.ts, src/components/ui/*.tsx, src/hooks/use-toast.ts
- Files modified: tailwind.config.ts, src/app/globals.css, package.json
- Verified: `pnpm check` passes (lint + typecheck + tests)

## Ticket #3: Clean .gitignore
- Updated .env* pattern to be more specific (.env*.local only)
- Verified all required patterns covered: node_modules, .next, *.tsbuildinfo, .DS_Store
- Confirmed ralph files (tickets.json, progress.txt, CLAUDE.md) remain tracked
- Files changed: .gitignore
- Verified: `pnpm check` passes

## Ticket #4: Zod schemas for ralph files
- Installed zod v4.3.5
- Created src/lib/schemas.ts with loose Zod schemas using passthrough()
- TicketSchema: id (number), title (string), description (optional), status (default 'pending'), priority (optional)
- TicketsFileSchema: { tickets: Ticket[] } with passthrough for unknown fields
- Added CreateTicketSchema and UpdateTicketSchema for API operations
- Created src/lib/schemas.test.ts with 17 integration tests
- Files added: src/lib/schemas.ts, src/lib/schemas.test.ts
- Files modified: package.json
- Verified: `pnpm check` passes (all 33 tests pass)

## Ticket #5: Setup tRPC with file system access
- Installed @trpc/server, @trpc/client, @trpc/react-query, @tanstack/react-query, superjson
- Created src/server/trpc.ts with context (ralphDir from RALPH_DIR env var), superjson transformer
- Created src/server/routers/_app.ts as main router (empty, ready for sub-routers)
- Created src/app/api/trpc/[trpc]/route.ts as fetch handler for GET/POST
- Created src/lib/trpc.ts with createTRPCReact hook for client usage
- Created src/components/providers/TRPCProvider.tsx with React Query + tRPC clients
- Updated src/app/layout.tsx to wrap app with TRPCProvider
- Files added: src/server/trpc.ts, src/server/routers/_app.ts, src/app/api/trpc/[trpc]/route.ts, src/lib/trpc.ts, src/components/providers/TRPCProvider.tsx
- Files modified: src/app/layout.tsx, package.json
- Verified: `pnpm check` passes (all 33 tests pass)

## Ticket #6: tRPC procedures for tickets CRUD
- Created src/server/routers/tickets.ts with full CRUD operations
- list() - reads/parses tickets.json with Zod schema validation
- get(id) - returns single ticket by id, throws if not found
- create(title, description?, priority?) - adds ticket with auto-incremented id
- update(id, data) - partial update, preserves unknown fields
- delete(id) - removes ticket by id
- All operations use Result type for railway-oriented error handling
- Registered tickets router in src/server/routers/_app.ts
- Created src/server/routers/tickets.test.ts with 12 integration tests
- Files added: src/server/routers/tickets.ts, src/server/routers/tickets.test.ts
- Files modified: src/server/routers/_app.ts
- Verified: `pnpm check` passes (all 45 tests pass)

## Ticket #7: tRPC procedure for progress.txt
- Created src/server/routers/progress.ts with read() procedure
- read() returns progress.txt content as string, empty string if file missing
- Uses tryCatchAsync/isErr for railway-oriented error handling
- Registered progress router in src/server/routers/_app.ts
- Created src/server/routers/progress.test.ts with 4 integration tests
- Files added: src/server/routers/progress.ts, src/server/routers/progress.test.ts
- Files modified: src/server/routers/_app.ts
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #8: Ticket list view component
- Created src/components/TicketList.tsx with tRPC integration
- Fetches tickets via trpc.tickets.list.useQuery()
- Displays cards with title, color-coded status badge, and priority
- Status colors: pending (yellow), in_progress (blue), completed (green), failed (red)
- Click to expand/select ticket, shows description when selected
- Supports controlled and uncontrolled selection modes via props
- Empty state when no tickets exist
- Loading and error states handled
- Files added: src/components/TicketList.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #18: Main page layout
- Redesigned src/app/page.tsx with split view layout
- Desktop: ticket list on left (400px), detail panel on right
- Mobile: tab-based navigation (Tickets/Details tabs)
- Header shows "Ralph Watch" title and project path from RALPH_DIR
- Created config router (src/server/routers/config.ts) with getProjectPath procedure
- Detail panel shows selected ticket info and progress log
- Progress log fetched via tRPC progress.read()
- Responsive design using lg: breakpoint for desktop view
- Files added: src/server/routers/config.ts
- Files modified: src/app/page.tsx, src/server/routers/_app.ts
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #9: Add ticket form
- Created src/components/AddTicketForm.tsx with tRPC integration
- Fields: title (required), description (textarea), priority (number, default 1)
- Submit via trpc.tickets.create.useMutation()
- Clears form on success, invalidates tickets.list query for automatic refresh
- Toast notifications for success and error states
- Client-side validation for required title field
- Disabled button with loading state during submission
- Files added: src/components/AddTicketForm.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #12: Progress.txt viewer component
- Created src/components/ProgressViewer.tsx with tRPC integration
- Fetches content via trpc.progress.read.useQuery()
- Uses ScrollArea with auto-scroll to bottom when content changes
- Configurable props: autoScroll (default true), height, title, showCard
- Renders as preformatted monospace text
- Loading, error, and empty states handled
- Integrated into main page DetailPanel, replacing inline progress display
- Files added: src/components/ProgressViewer.tsx
- Files modified: src/app/page.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #10: Edit ticket functionality
- Created src/components/EditTicketForm.tsx with tRPC integration
- Fields: title (required), description (textarea), priority (number), status (select dropdown)
- Status dropdown shows all valid statuses: pending, in_progress, completed, failed
- Submit via trpc.tickets.update.useMutation()
- Toast notifications for success and error states
- Inline editing in detail panel with Edit button toggle
- Cancel button returns to view mode without saving
- Updated Home component to track selectedTicketId instead of full ticket object
- Ticket data now syncs from tRPC query, auto-refreshes after edits
- Files added: src/components/EditTicketForm.tsx
- Files modified: src/app/page.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #11: Delete ticket functionality
- Added shadcn AlertDialog component for confirmation dialogs
- Created src/components/DeleteTicketButton.tsx with tRPC integration
- Uses AlertDialog for confirmation before deleting
- Calls trpc.tickets.delete.useMutation() on confirm
- Toast notifications for success and error states
- Integrated delete button into DetailPanel next to edit button
- Added onTicketDeleted callback to clear selection and return to ticket list after delete
- Ran pnpm format to fix shadcn generated files formatting
- Files added: src/components/DeleteTicketButton.tsx, src/components/ui/alert-dialog.tsx
- Files modified: src/app/page.tsx, src/components/ui/button.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #13: SSE endpoint for file watching
- Installed chokidar v5.0.0 for file watching
- Created src/app/api/watch/route.ts SSE endpoint
- Uses singleton FSWatcher to watch tickets.json and progress.txt in RALPH_DIR
- Broadcasts file change events to all connected SSE clients
- Event types: 'connected' (on connect), 'tickets' (tickets.json changed), 'progress' (progress.txt changed), 'error'
- Uses awaitWriteFinish option for stability (100ms threshold)
- Proper cleanup when clients disconnect
- Files added: src/app/api/watch/route.ts
- Files modified: package.json
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #14: Live updates via SSE
- Created src/hooks/use-file-watch.ts with useFileWatch hook
- Connects to /api/watch SSE endpoint via EventSource
- Listens for 'tickets' events and invalidates tickets tRPC queries
- Listens for 'progress' events and invalidates progress tRPC queries
- Automatic reconnection after 3 seconds on disconnect
- State-driven connection: 'connecting' -> 'connected' -> 'disconnected' -> 'connecting'
- Created src/components/ConnectionStatus.tsx with ConnectionStatusIndicator component
- Shows colored dot (green=connected, yellow=connecting, red=disconnected) and status text
- Integrated into Header component in page.tsx
- Files added: src/hooks/use-file-watch.ts, src/components/ConnectionStatus.tsx
- Files modified: src/app/page.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #15: Status filtering
- Created src/components/TicketFilter.tsx with tab-style filter buttons
- Filter options: all, pending, in_progress, completed, failed
- Created src/hooks/use-ticket-filter.ts for URL params persistence
- Uses Next.js useSearchParams/useRouter to sync filter state with URL (?status=pending etc)
- Updated TicketList to accept statusFilter prop and filter tickets client-side
- Added empty state for when no tickets match the current filter
- Wrapped Home in Suspense boundary (required for useSearchParams)
- Adjusted scroll area height to accommodate filter controls
- Files added: src/components/TicketFilter.tsx, src/hooks/use-ticket-filter.ts
- Files modified: src/components/TicketList.tsx, src/app/page.tsx
- Verified: `pnpm check` passes (all 49 tests pass)
