# Ralph Progress Log

## Ticket #1: Init Next.js project with pnpm
- Created Next.js 16 app with App Router, TypeScript, Tailwind, ESLint, pnpm
- Moved project contents from ralph-watch-ui/ subdirectory to workspace root
- Downgraded Tailwind from v4 to v3 due to native binding issues in NixOS environment
- Added tailwind.config.ts, updated postcss.config.mjs and globals.css for Tailwind v3
- Files added: package.json, tsconfig.json, next.config.ts, eslint.config.mjs, postcss.config.mjs, tailwind.config.ts, src/, public/
- Verified: `pnpm build` and `pnpm lint` pass

## Ticket #20: ESLint + Prettier + strict TS + quality check
- Installed prettier, eslint-config-prettier, eslint-plugin-prettier, lodash, @types/lodash
- Created .prettierrc with singleQuote, semi, tabWidth 2
- Updated eslint.config.mjs to extend prettier (flat config format)
- Created .prettierignore to exclude read-only files
- Enabled noUncheckedIndexedAccess in tsconfig.json
- Added scripts: format, lint (updated), typecheck, check
- Ran pnpm format to fix quote styles across codebase
- Files changed: package.json, tsconfig.json, eslint.config.mjs, .prettierrc, .prettierignore
- Verified: `pnpm check` passes (lint + typecheck)

## Ticket #21: Result type utilities for railway-oriented flow
- Created src/lib/result.ts with railway-oriented programming utilities
- Implemented Result<T, E> discriminated union (Ok/Err)
- Added constructor functions: ok(), err()
- Added type guards: isOk(), isErr()
- Added transformations: map(), flatMap(), mapErr()
- Added utilities: unwrapOr(), tryCatch(), tryCatchAsync()
- Files added: src/lib/result.ts
- Verified: `pnpm check` passes

## Ticket #22: Test setup with vitest
- Installed vitest, @testing-library/react, @testing-library/dom, jsdom, @vitejs/plugin-react
- Created vitest.config.ts with jsdom environment and react plugin
- Added scripts: `test` (vitest run), `test:watch` (vitest)
- Updated `check` script to include test: lint + typecheck + test
- Created src/lib/result.test.ts with 16 integration tests for Result utilities
- Files added: vitest.config.ts, src/lib/result.test.ts
- Verified: `pnpm check` passes (all 16 tests pass)

## Ticket #2: Add shadcn/ui and configure
- Initialized shadcn/ui with `pnpm dlx shadcn@latest init` (Neutral color theme)
- Added components: button, card, input, textarea, badge, scroll-area, toast (+ toaster)
- Created components.json config and src/lib/utils.ts (cn utility)
- Created src/hooks/use-toast.ts for toast functionality
- Fixed tailwind.config.ts to use ESM import for tailwindcss-animate
- Fixed eslint warning in use-toast.ts
- Ran pnpm format to fix prettier formatting issues
- Files added: components.json, src/lib/utils.ts, src/components/ui/*.tsx, src/hooks/use-toast.ts
- Files modified: tailwind.config.ts, src/app/globals.css, package.json
- Verified: `pnpm check` passes (lint + typecheck + tests)

## Ticket #3: Clean .gitignore
- Updated .env* pattern to be more specific (.env*.local only)
- Verified all required patterns covered: node_modules, .next, *.tsbuildinfo, .DS_Store
- Confirmed ralph files (tickets.json, progress.txt, CLAUDE.md) remain tracked
- Files changed: .gitignore
- Verified: `pnpm check` passes

## Ticket #4: Zod schemas for ralph files
- Installed zod v4.3.5
- Created src/lib/schemas.ts with loose Zod schemas using passthrough()
- TicketSchema: id (number), title (string), description (optional), status (default 'pending'), priority (optional)
- TicketsFileSchema: { tickets: Ticket[] } with passthrough for unknown fields
- Added CreateTicketSchema and UpdateTicketSchema for API operations
- Created src/lib/schemas.test.ts with 17 integration tests
- Files added: src/lib/schemas.ts, src/lib/schemas.test.ts
- Files modified: package.json
- Verified: `pnpm check` passes (all 33 tests pass)

## Ticket #5: Setup tRPC with file system access
- Installed @trpc/server, @trpc/client, @trpc/react-query, @tanstack/react-query, superjson
- Created src/server/trpc.ts with context (ralphDir from RALPH_DIR env var), superjson transformer
- Created src/server/routers/_app.ts as main router (empty, ready for sub-routers)
- Created src/app/api/trpc/[trpc]/route.ts as fetch handler for GET/POST
- Created src/lib/trpc.ts with createTRPCReact hook for client usage
- Created src/components/providers/TRPCProvider.tsx with React Query + tRPC clients
- Updated src/app/layout.tsx to wrap app with TRPCProvider
- Files added: src/server/trpc.ts, src/server/routers/_app.ts, src/app/api/trpc/[trpc]/route.ts, src/lib/trpc.ts, src/components/providers/TRPCProvider.tsx
- Files modified: src/app/layout.tsx, package.json
- Verified: `pnpm check` passes (all 33 tests pass)

## Ticket #6: tRPC procedures for tickets CRUD
- Created src/server/routers/tickets.ts with full CRUD operations
- list() - reads/parses tickets.json with Zod schema validation
- get(id) - returns single ticket by id, throws if not found
- create(title, description?, priority?) - adds ticket with auto-incremented id
- update(id, data) - partial update, preserves unknown fields
- delete(id) - removes ticket by id
- All operations use Result type for railway-oriented error handling
- Registered tickets router in src/server/routers/_app.ts
- Created src/server/routers/tickets.test.ts with 12 integration tests
- Files added: src/server/routers/tickets.ts, src/server/routers/tickets.test.ts
- Files modified: src/server/routers/_app.ts
- Verified: `pnpm check` passes (all 45 tests pass)

## Ticket #7: tRPC procedure for progress.txt
- Created src/server/routers/progress.ts with read() procedure
- read() returns progress.txt content as string, empty string if file missing
- Uses tryCatchAsync/isErr for railway-oriented error handling
- Registered progress router in src/server/routers/_app.ts
- Created src/server/routers/progress.test.ts with 4 integration tests
- Files added: src/server/routers/progress.ts, src/server/routers/progress.test.ts
- Files modified: src/server/routers/_app.ts
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #8: Ticket list view component
- Created src/components/TicketList.tsx with tRPC integration
- Fetches tickets via trpc.tickets.list.useQuery()
- Displays cards with title, color-coded status badge, and priority
- Status colors: pending (yellow), in_progress (blue), completed (green), failed (red)
- Click to expand/select ticket, shows description when selected
- Supports controlled and uncontrolled selection modes via props
- Empty state when no tickets exist
- Loading and error states handled
- Files added: src/components/TicketList.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #18: Main page layout
- Redesigned src/app/page.tsx with split view layout
- Desktop: ticket list on left (400px), detail panel on right
- Mobile: tab-based navigation (Tickets/Details tabs)
- Header shows "Ralph Watch" title and project path from RALPH_DIR
- Created config router (src/server/routers/config.ts) with getProjectPath procedure
- Detail panel shows selected ticket info and progress log
- Progress log fetched via tRPC progress.read()
- Responsive design using lg: breakpoint for desktop view
- Files added: src/server/routers/config.ts
- Files modified: src/app/page.tsx, src/server/routers/_app.ts
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #9: Add ticket form
- Created src/components/AddTicketForm.tsx with tRPC integration
- Fields: title (required), description (textarea), priority (number, default 1)
- Submit via trpc.tickets.create.useMutation()
- Clears form on success, invalidates tickets.list query for automatic refresh
- Toast notifications for success and error states
- Client-side validation for required title field
- Disabled button with loading state during submission
- Files added: src/components/AddTicketForm.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #12: Progress.txt viewer component
- Created src/components/ProgressViewer.tsx with tRPC integration
- Fetches content via trpc.progress.read.useQuery()
- Uses ScrollArea with auto-scroll to bottom when content changes
- Configurable props: autoScroll (default true), height, title, showCard
- Renders as preformatted monospace text
- Loading, error, and empty states handled
- Integrated into main page DetailPanel, replacing inline progress display
- Files added: src/components/ProgressViewer.tsx
- Files modified: src/app/page.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #10: Edit ticket functionality
- Created src/components/EditTicketForm.tsx with tRPC integration
- Fields: title (required), description (textarea), priority (number), status (select dropdown)
- Status dropdown shows all valid statuses: pending, in_progress, completed, failed
- Submit via trpc.tickets.update.useMutation()
- Toast notifications for success and error states
- Inline editing in detail panel with Edit button toggle
- Cancel button returns to view mode without saving
- Updated Home component to track selectedTicketId instead of full ticket object
- Ticket data now syncs from tRPC query, auto-refreshes after edits
- Files added: src/components/EditTicketForm.tsx
- Files modified: src/app/page.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #11: Delete ticket functionality
- Added shadcn AlertDialog component for confirmation dialogs
- Created src/components/DeleteTicketButton.tsx with tRPC integration
- Uses AlertDialog for confirmation before deleting
- Calls trpc.tickets.delete.useMutation() on confirm
- Toast notifications for success and error states
- Integrated delete button into DetailPanel next to edit button
- Added onTicketDeleted callback to clear selection and return to ticket list after delete
- Ran pnpm format to fix shadcn generated files formatting
- Files added: src/components/DeleteTicketButton.tsx, src/components/ui/alert-dialog.tsx
- Files modified: src/app/page.tsx, src/components/ui/button.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #13: SSE endpoint for file watching
- Installed chokidar v5.0.0 for file watching
- Created src/app/api/watch/route.ts SSE endpoint
- Uses singleton FSWatcher to watch tickets.json and progress.txt in RALPH_DIR
- Broadcasts file change events to all connected SSE clients
- Event types: 'connected' (on connect), 'tickets' (tickets.json changed), 'progress' (progress.txt changed), 'error'
- Uses awaitWriteFinish option for stability (100ms threshold)
- Proper cleanup when clients disconnect
- Files added: src/app/api/watch/route.ts
- Files modified: package.json
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #14: Live updates via SSE
- Created src/hooks/use-file-watch.ts with useFileWatch hook
- Connects to /api/watch SSE endpoint via EventSource
- Listens for 'tickets' events and invalidates tickets tRPC queries
- Listens for 'progress' events and invalidates progress tRPC queries
- Automatic reconnection after 3 seconds on disconnect
- State-driven connection: 'connecting' -> 'connected' -> 'disconnected' -> 'connecting'
- Created src/components/ConnectionStatus.tsx with ConnectionStatusIndicator component
- Shows colored dot (green=connected, yellow=connecting, red=disconnected) and status text
- Integrated into Header component in page.tsx
- Files added: src/hooks/use-file-watch.ts, src/components/ConnectionStatus.tsx
- Files modified: src/app/page.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #15: Status filtering
- Created src/components/TicketFilter.tsx with tab-style filter buttons
- Filter options: all, pending, in_progress, completed, failed
- Created src/hooks/use-ticket-filter.ts for URL params persistence
- Uses Next.js useSearchParams/useRouter to sync filter state with URL (?status=pending etc)
- Updated TicketList to accept statusFilter prop and filter tickets client-side
- Added empty state for when no tickets match the current filter
- Wrapped Home in Suspense boundary (required for useSearchParams)
- Adjusted scroll area height to accommodate filter controls
- Files added: src/components/TicketFilter.tsx, src/hooks/use-ticket-filter.ts
- Files modified: src/components/TicketList.tsx, src/app/page.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #16: Execute ralph commands from UI
- Created src/server/routers/ralph.ts with runOnce and runAll procedures
- runOnce spawns `ralph-once` (process next ticket) as fire-and-forget
- runAll spawns `ralph` (loop) as fire-and-forget
- Uses spawn with detached:true, stdio:'ignore', and unref() for proper background execution
- Created src/components/RalphControls.tsx with "Run Next Ticket" and "Run All" buttons
- Buttons show loading state and toast notifications on success/error
- Registered ralph router in _app.ts
- Integrated RalphControls into Header next to connection status
- Files added: src/server/routers/ralph.ts, src/components/RalphControls.tsx
- Files modified: src/server/routers/_app.ts, src/app/page.tsx
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #17: Desktop notifications
- Created src/hooks/use-notifications.ts with useNotifications hook
- Requests browser notification permission on page load
- Uses useSyncExternalStore for SSR-safe permission state
- Tracks tab focus state via visibilitychange and focus/blur events
- showNotification() only fires when tab is not focused
- Updated src/hooks/use-file-watch.ts to detect ticket status changes
- Added previousTicketsRef to track ticket states across SSE events
- onTicketStatusChange callback triggers when status changes to 'completed' or 'failed'
- Updated ConnectionStatusIndicator to integrate notifications
- Shows notification permission indicator (pending/blocked) in status bar
- Files added: src/hooks/use-notifications.ts
- Files modified: src/hooks/use-file-watch.ts, src/components/ConnectionStatus.tsx
- Verified: `pnpm check` passes (all 49 tests pass)
## Ticket #19: Multi-project support
- Created src/lib/projects.ts with localStorage utilities for project persistence
- Functions: getProjects, saveProjects, addProject, removeProject, get/setActiveProject
- Per-project filter state persistence: getProjectFilter, setProjectFilter
- Created src/hooks/use-projects.ts with useSyncExternalStore for reactive project list
- Created src/components/ProjectSwitcher.tsx dropdown component
- Uses shadcn Command/Popover components for searchable project selection
- Shows project name and path, add new projects, remove projects
- Added x-ralph-dir header support to tRPC for dynamic project selection
- Updated src/server/trpc.ts createContext to read header and override RALPH_DIR
- Updated tickets, progress, and ralph routers to use ctx.ralphDir
- Updated src/app/api/watch/route.ts to accept dir query parameter
- Per-directory watcher management with cleanup when clients disconnect
- Created src/components/providers/ProjectProvider.tsx for project context
- Created src/components/providers/AppProviders.tsx to combine providers
- Updated src/hooks/use-file-watch.ts to accept ralphDir and reconnect on change
- Updated page.tsx with ProjectSwitcher in header and key-based remounting
- Per-project filter state restored when switching projects
- Fixed test files to use Context type directly instead of createContext()
- Files added: src/lib/projects.ts, src/hooks/use-projects.ts, src/components/ProjectSwitcher.tsx, src/components/providers/ProjectProvider.tsx, src/components/providers/AppProviders.tsx, src/components/ui/command.tsx, src/components/ui/popover.tsx, src/components/ui/select.tsx
- Files modified: src/server/trpc.ts, src/server/routers/tickets.ts, src/server/routers/progress.ts, src/server/routers/ralph.ts, src/app/api/watch/route.ts, src/hooks/use-file-watch.ts, src/components/ConnectionStatus.tsx, src/components/providers/TRPCProvider.tsx, src/app/layout.tsx, src/app/page.tsx, src/server/routers/tickets.test.ts, src/server/routers/progress.test.ts
- Verified: `pnpm check` passes (all 49 tests pass)

## Ticket #23: Fix useSyncExternalStore infinite loop in useProjects
- Bug: getProjectsSnapshot() returned getProjects() which creates new array from JSON.parse each call
- React's useSyncExternalStore saw different reference, triggered re-render, infinite loop
- Fix: Added module-level projectsCache (initialized to EMPTY_PROJECTS)
- Created refreshCache() function that updates projectsCache and calls notifySubscribers()
- getProjectsSnapshot() now returns cached value, initializes cache on first client-side read
- Updated addProject, removeProject, setActiveProject to call refreshCache() instead of notifySubscribers()
- Created src/hooks/use-projects.test.ts with 8 integration tests
- Tests verify: no errors on render, stable references on re-render, add/remove/setActive operations, multiple hook instances
- Files modified: src/hooks/use-projects.ts
- Files added: src/hooks/use-projects.test.ts
- Verified: `pnpm check` passes (all 57 tests pass)

## Ticket #24: Fix hydration mismatch in useNotifications isSupported
- Bug: isSupported computed as `typeof window !== 'undefined' && 'Notification' in window`
- This is false on server but true on client, causing hydration mismatch
- Fix: Used useSyncExternalStore instead of direct computation
- Added getIsSupportedSnapshot() for client (returns `'Notification' in window`)
- Added getIsSupportedServerSnapshot() for server (returns false)
- This ensures server and initial client render match (both false), then React handles the transition
- Note: ticket suggested useState + useEffect but that triggered ESLint set-state-in-effect rule
- Files modified: src/hooks/use-notifications.ts
- Verified: `pnpm check` passes (all 57 tests pass)

## Ticket #25: ProcessRunner interface and types
- Created src/lib/process-runner.ts with types for process lifecycle management
- ProcessHandle: { id: string; pid: number } for identifying spawned processes
- ProcessStatus: discriminated union with 'running' (pid), 'exited' (code), 'not_found' states
- ProcessOutputLine: { stream: 'stdout'|'stderr'; line: string; timestamp: number }
- ProcessStartOptions: { command: string; cwd: string }
- ProcessRunner interface with start, getStatus, kill, onOutput, listRunning methods
- Type guards: isRunning(), isExited(), isNotFound() for status discrimination
- ProcessStatusFactory helper for creating status values
- Created src/lib/process-runner.test.ts with 26 unit tests
- Tests cover: type structure, type guards, factory functions, exhaustive switch matching
- Files added: src/lib/process-runner.ts, src/lib/process-runner.test.ts
- Verified: `pnpm check` passes (all 83 tests pass)

## Ticket #26: ProcessRunner implementation
- Created src/server/services/process-runner.ts implementing ProcessRunner interface
- Uses child_process.spawn with shell: true, stdio: ['ignore', 'pipe', 'pipe']
- Stores processes in Map<string, ProcessRecord> with child, handle, output, callbacks
- ID generation using timestamp + random string (no external deps)
- stdout/stderr capture via readline.createInterface for line-by-line output
- Each output line includes stream type, content, and timestamp
- Exit handling updates exited flag and stores exit code
- onOutput replays existing output to new subscribers, supports unsubscribe
- kill uses SIGTERM with SIGKILL fallback
- listRunning filters for non-exited processes
- Factory function createProcessRunner() for fresh instances
- Singleton getProcessRunner() for server-side use
- Created src/server/services/process-runner.test.ts with 21 integration tests
- Tests spawn real processes (echo, sleep, exit) and verify output capture, status transitions
- Files added: src/server/services/process-runner.ts, src/server/services/process-runner.test.ts
- Verified: `pnpm check` passes (all 104 tests pass)

## Ticket #27: tRPC procedures for ProcessRunner
- Created src/server/routers/process.ts with tRPC router for process management
- start(command) - spawns process via runner.start with ctx.ralphDir as cwd, returns handle or throws
- status(id) - returns ProcessStatus (running/exited/not_found) via runner.getStatus
- kill(id) - terminates process via runner.kill, returns {success: true} or throws
- list() - returns all running ProcessHandle[] via runner.listRunning
- Module-level instance pattern with getRunner()/setRunner() for DI/testing
- Uses singleton getProcessRunner() from services by default
- Registered process router in src/server/routers/_app.ts
- Created src/server/routers/process.test.ts with 16 tests using mock ProcessRunner
- Tests verify: correct args passed, return values, error handling, input validation
- Files added: src/server/routers/process.ts, src/server/routers/process.test.ts
- Files modified: src/server/routers/_app.ts
- Verified: `pnpm check` passes (all 120 tests pass)

## Ticket #28: SSE endpoint for process output streaming
- Created src/app/api/process/[id]/stream/route.ts SSE endpoint
- GET /api/process/[id]/stream - subscribes to process output via runner.onOutput()
- Sends 'connected' event on initial connection with process id
- Streams 'output' events with ProcessOutputLine JSON (stream, line, timestamp)
- Polls for exit status and sends 'exit' event with code when process completes
- Returns 404 if process not found
- Handles already-exited processes by sending exit event immediately
- Proper cleanup on client disconnect (unsubscribe + clear interval)
- Added setRunner/getRunner for dependency injection in tests
- Created src/app/api/process/[id]/stream/route.test.ts with 6 integration tests
- Tests verify: 404 for unknown, connected event, output streaming, exit events, stderr capture
- Files added: src/app/api/process/[id]/stream/route.ts, src/app/api/process/[id]/stream/route.test.ts
- Verified: `pnpm check` passes (all 126 tests pass)

## Ticket #29: useProcessOutput hook
- Created src/hooks/use-process-output.ts for subscribing to process output via SSE
- Hook takes processId (string | null | undefined), returns lines, isConnected, exitCode, connectionStatus, clearLines
- Connects to /api/process/[id]/stream SSE endpoint when processId is truthy
- Accumulates ProcessOutputLine[] in state from 'output' events
- Handles 'connected' event to update connection status
- Handles 'exit' event to store exit code and close connection
- Handles connection errors by setting status to 'disconnected'
- Cleans up EventSource on unmount or processId change
- Resets state (lines, exitCode, connectionStatus) when processId changes
- Returns stable empty values when processId is null/undefined
- Created src/hooks/use-process-output.test.ts with 16 tests using mocked EventSource
- Tests verify: connection behavior, event handling, state management, cleanup
- Files added: src/hooks/use-process-output.ts, src/hooks/use-process-output.test.ts
- Verified: `pnpm check` passes (all 142 tests pass)

## Ticket #30: ProcessOutputViewer component
- Created src/components/ProcessOutputViewer.tsx for real-time process output display
- Uses useProcessOutput hook to subscribe to process output via SSE
- Renders output lines in ScrollArea with monospace font
- stdout lines in default color, stderr lines in red (text-destructive)
- Auto-scroll to bottom when new output arrives (with toggle button)
- Shows "Process exited with code X" with color: green for 0, red for non-zero
- Connection status badge: Connected/Connecting.../Disconnected
- Props: processId, height, title, showCard, initialAutoScroll
- Empty states: "No process selected", "Connecting...", "No output yet"
- Installed @testing-library/jest-dom for DOM matchers in component tests
- Created src/test-setup.ts to configure jest-dom with vitest
- Updated vitest.config.ts to use setupFiles
- Created src/components/ProcessOutputViewer.test.tsx with 24 tests
- Tests verify: rendering, output display, stderr styling, exit codes, connection status, auto-scroll toggle
- Files added: src/components/ProcessOutputViewer.tsx, src/components/ProcessOutputViewer.test.tsx, src/test-setup.ts
- Files modified: vitest.config.ts, package.json
- Verified: `pnpm check` passes (all 166 tests pass)

## Ticket #31: Update RalphControls to use ProcessRunner
- Refactored src/components/RalphControls.tsx to use ProcessRunner for full lifecycle management
- Replaced fire-and-forget mutations (ralph.runOnce, ralph.runAll) with process.start
- On click: calls process.start mutation, stores processId in state
- Added shadcn/ui collapsible component for output panel
- Shows ProcessOutputViewer in collapsible panel with real-time output streaming
- Running state: status text with animated pulse, disabled buttons, connection status indicator
- Stop button: appears during running, calls process.kill mutation
- Process exit: detects via useProcessOutput hook, shows Completed/Failed status with color coding
- Clear button: appears after process exits to dismiss output panel
- Used useEffect with queueMicrotask for ESLint-compliant exit handling
- Created src/components/RalphControls.test.tsx with 20 tests
- Tests verify: button rendering, mutation calls, running state, stop functionality, output visibility, process completion, button states, connection status, hook integration
- Files added: src/components/RalphControls.test.tsx, src/components/ui/collapsible.tsx
- Files modified: src/components/RalphControls.tsx
- Verified: `pnpm check` passes (all 186 tests pass)

## Ticket #32: Remove old fire-and-forget ralph router
- Deleted src/server/routers/ralph.ts (old fire-and-forget runOnce/runAll procedures)
- Removed ralphRouter import and registration from src/server/routers/_app.ts
- RalphControls already uses process.start/kill from ProcessRunner - no changes needed
- Verified no remaining references to ralphRouter or trpc.ralph in codebase
- Files deleted: src/server/routers/ralph.ts
- Files modified: src/server/routers/_app.ts
- Verified: `pnpm check` passes (all 186 tests pass)

## Ticket #33: Support RALPH_BIN env var for ralph commands
- Added resolveCommand() function to process-runner.ts
- Checks RALPH_BIN env var and prepends path for commands starting with 'ralph'
- E.g., 'ralph-once' becomes '/path/to/bin/ralph-once' when RALPH_BIN=/path/to/bin
- Handles trailing slashes, arguments, whitespace trimming
- start() now calls resolveCommand() before spawning
- Created .env.example with RALPH_BIN, RALPH_DIR, and REACT_EDITOR vars
- Added 9 unit tests for resolveCommand() function
- Tests verify: no RALPH_BIN, non-ralph commands, ralph/ralph-once, args preservation, trailing slash handling
- Files added: .env.example
- Files modified: src/server/services/process-runner.ts, src/server/services/process-runner.test.ts
- Verified: `pnpm check` passes (all 195 tests pass)

## Ticket #34: Validate required env vars on startup
- Created src/lib/env.ts with Zod schema for environment validation
- EnvSchema validates: RALPH_BIN (required), RALPH_DIR (optional), REACT_EDITOR (optional)
- parseEnv() function parses and validates with custom error messages
- getEnv() caches parsed env, throws early if missing required vars
- Error message format: "Missing RALPH_BIN - set path to ralph bin directory"
- Imported and called getEnv() in src/server/trpc.ts on server startup
- Skips validation in test environment (NODE_ENV=test) to avoid breaking tests
- Created src/lib/env.test.ts with 8 tests for validation and caching behavior
- Tests verify: valid parsing, missing var errors, caching, reset functionality
- Files added: src/lib/env.ts, src/lib/env.test.ts
- Files modified: src/server/trpc.ts
- Verified: `pnpm check` passes (all 203 tests pass)

## Ticket #35: Say hi
- Hello!
- No code changes (no-op ticket)

## Ticket #36: Fix file watcher query invalidation with IoC
- Bug: useFileWatch used queryClient.invalidateQueries() with manually constructed keys
- Keys like [['progress']] didn't match tRPC's internal key format
- Progress updates weren't triggering re-fetch
- Fix: Inverted control - hook now accepts callbacks instead of doing invalidation directly
- Added onTicketsChange, onProgressChange, getTickets callbacks to UseFileWatchOptions
- Removed useQueryClient import and queryClient usage from useFileWatch
- Updated ConnectionStatusIndicator to use trpc.useUtils()
- Passes utils.tickets.list.invalidate() and utils.progress.read.invalidate() as callbacks
- getTickets callback uses utils.tickets.list.getData() for status change detection
- Files modified: src/hooks/use-file-watch.ts, src/components/ConnectionStatus.tsx
- Verified: `pnpm check` passes (all 203 tests pass)

## Ticket #37: Side panel UX for ralph controls and output
- Created src/components/RalphSidePanel.tsx as persistent side panel for ralph controls
- Panel features: Run Next Ticket and Run All buttons at top, Stop button during running
- ProcessOutputViewer below buttons for real-time output streaming
- Panel is 350px wide with collapsible design (collapse button toggles visibility)
- Collapsed view shows status indicators (running/completed/failed dots)
- Expanded view shows: buttons, status text, connection status, output viewer
- Auto-expands when process starts, can manually collapse/expand
- Updated src/app/page.tsx to include RalphSidePanel in layout (right side)
- Removed RalphControls from header, main content area gets remaining width
- Updated RalphSidePanel.test.tsx to match new component structure
- Removed toggle-output tests (output always visible when expanded)
- Added panel collapse/expand tests
- Files added: src/components/RalphSidePanel.tsx, src/components/RalphSidePanel.test.tsx
- Files modified: src/app/page.tsx
- Verified: `pnpm check` passes (all 203 tests pass)

## Ticket #38: Consolidate status badge utilities
- Extracted duplicated getStatusBadgeClass() and formatStatus() from page.tsx and TicketList.tsx
- Created src/lib/ticket-ui.ts with shared UI utilities for ticket display
- getStatusBadgeClass(status) - returns Tailwind badge color classes for each status
- formatStatus(status) - replaces underscores with spaces for display
- Updated src/app/page.tsx to import from @/lib/ticket-ui
- Updated src/components/TicketList.tsx to import from @/lib/ticket-ui
- Files added: src/lib/ticket-ui.ts
- Files modified: src/app/page.tsx, src/components/TicketList.tsx
- Verified: `pnpm check` passes (all 203 tests pass)

## Ticket #39: Clean up comments per style guide
- Audited all source files for comments per style guide rules
- Removed section header comments that restated what code does (e.g., "// Constructors", "// Type guards")
- Removed imperative comments explaining history or obvious code behavior
- Kept comments providing context on design decisions (e.g., useSyncExternalStore cache rationale)
- Removed JSX comments labeling UI sections (e.g., "Collapse toggle", "Control buttons")
- Consolidated multi-line comment blocks where appropriate
- Files modified: src/lib/result.ts, src/lib/process-runner.ts, src/lib/projects.ts, src/hooks/use-projects.ts, src/hooks/use-notifications.ts, src/hooks/use-file-watch.ts, src/hooks/use-process-output.ts, src/app/api/watch/route.ts, src/app/api/process/[id]/stream/route.ts, src/server/services/process-runner.ts, src/components/RalphSidePanel.tsx, src/components/RalphControls.tsx
- Verified: `pnpm check` passes (all 203 tests pass)

## Ticket #40: Add process output ring buffer
- Added MAX_OUTPUT_LINES = 5000 constant to prevent unbounded memory growth
- Created pushOutputLine() helper function that shifts oldest line when limit exceeded
- Updated all three output push locations (stdout, stderr, error handlers) to use helper
- Files modified: src/server/services/process-runner.ts
- Verified: `pnpm check` passes (all 203 tests pass)

## Ticket #41: Add onExit callback to ProcessRunner
- Added onExit(id, callback) to ProcessRunner interface in src/lib/process-runner.ts
- Callback called once when process exits with exit code, or immediately if already exited
- Added exitCallbacks Set to ProcessRecord in implementation
- Implemented onExit() with immediate callback for already-exited processes and unsubscribe support
- Fire exit callbacks from child.on('exit') event handler
- Updated SSE endpoint /api/process/[id]/stream to use onExit instead of setInterval polling
- Removed wasteful 100ms polling loop, replaced with event-driven exit notification
- Added 6 new tests for onExit functionality (callback timing, exit codes, unsubscribe, multiple subscribers)
- Updated mock ProcessRunner in process.test.ts to include onExit
- Files modified: src/lib/process-runner.ts, src/server/services/process-runner.ts, src/app/api/process/[id]/stream/route.ts, src/server/routers/process.test.ts, src/server/services/process-runner.test.ts
- Verified: `pnpm check` passes (all 209 tests pass)

## Ticket #42: URL-based project routing
- Replaced localStorage/context project management with URL-based routing
- Created src/lib/project-path.ts with encodeProjectPath()/decodeProjectPath() (base64url)
- Created src/app/project/[path]/page.tsx - main project view with ticket list, details, RalphSidePanel
- Created src/app/project/[path]/layout.tsx - wraps with TRPCProvider, passes decoded project path
- Updated src/app/page.tsx to be project picker - shows recent projects from cookies
- Created src/lib/recent-projects.ts with cookie-based recent project storage
- Simplified TRPCProvider - now takes projectPath prop directly, creates fresh clients per project
- Added useProjectPath() hook for components to access current project
- Updated ConnectionStatusIndicator to use useProjectPath() instead of old context
- Deleted: ProjectProvider.tsx, AppProviders.tsx, use-projects.ts, use-projects.test.ts, ProjectSwitcher.tsx, projects.ts
- Updated layout.tsx - removed AppProviders wrapper, TRPCProvider now lives in project layout
- Added 14 tests for project-path encoding/decoding
- Data flow now: URL → Next.js params → decoded in layout → TRPCProvider context → useProjectPath() hook
- Files added: src/lib/project-path.ts, src/lib/project-path.test.ts, src/lib/recent-projects.ts, src/app/project/[path]/page.tsx, src/app/project/[path]/layout.tsx
- Files modified: src/app/page.tsx, src/app/layout.tsx, src/components/providers/TRPCProvider.tsx, src/components/ConnectionStatus.tsx
- Files deleted: src/components/providers/ProjectProvider.tsx, src/components/providers/AppProviders.tsx, src/hooks/use-projects.ts, src/hooks/use-projects.test.ts, src/components/ProjectSwitcher.tsx, src/lib/projects.ts
- Verified: `pnpm check` passes (all 215 tests pass)
## Ticket #43: Unify SSE into single event stream
- Consolidated /api/watch and /api/process/[id]/stream into single /api/events endpoint
- Created src/app/api/events/route.ts - unified SSE endpoint supporting multiple topics
  - Topics: 'tickets', 'progress', 'process:{id}'
  - Events: {topic: string, type: string, data: any}
  - File watchers for tickets.json and progress.txt
  - Process output via runner.onOutput() and runner.onExit()
- Created src/hooks/use-event-stream.ts - unified client hook
  - Takes project path and topics array
  - Returns connectionStatus and subscribe function
  - Supports dynamic topic changes (reconnects when topics change)
  - onTicketsChange, onProgressChange, onProcessOutput, onProcessExit callbacks
- Updated ConnectionStatusIndicator to use useEventStream with topics=['tickets', 'progress']
- Updated RalphSidePanel to use useEventStream with dynamic process topic
- Updated ProcessOutputViewer to be a controlled component (receives lines/exitCode/connectionStatus as props)
- Deleted old SSE endpoints: /api/watch/route.ts, /api/process/[id]/stream/route.ts
- Deleted old hooks: use-file-watch.ts, use-process-output.ts, use-process-output.test.ts
- Deleted unused RalphControls.tsx component
- Updated tests: ProcessOutputViewer.test.tsx, RalphSidePanel.test.tsx
- Files added: src/app/api/events/route.ts, src/hooks/use-event-stream.ts
- Files modified: src/components/ConnectionStatus.tsx, src/components/RalphSidePanel.tsx, src/components/ProcessOutputViewer.tsx
- Files deleted: src/app/api/watch/route.ts, src/app/api/process/[id]/stream/route.ts, src/hooks/use-file-watch.ts, src/hooks/use-process-output.ts, src/hooks/use-process-output.test.ts, src/components/RalphControls.tsx
- Verified: `pnpm check` passes (all 186 tests pass)

## Ticket #44: Quick-add tickets with draft status
- Added 'draft' to ticketStatuses in src/lib/schemas.ts
- Updated CreateTicketSchema to accept optional status (draft|pending)
- Updated tickets router create mutation to use provided status
- Added draft badge styling (gray/muted) to src/lib/ticket-ui.ts
- Added 'draft' to TicketFilter status options and validation
- Created src/components/QuickAddBar.tsx:
  - Always-visible input bar at bottom of ticket list
  - Enter = create as draft, Shift+Enter = create as pending
  - '+' button expands to full AddTicketForm
  - Auto-focus stays in input for rapid entry
- Updated AddTicketForm with status radio buttons (draft/pending)
- Updated TicketList:
  - Draft tickets show dimmed/faded (opacity-60)
  - 'Ready' button on draft tickets promotes to pending status
  - Added markReady mutation with optimistic UI
- Integrated QuickAddBar into project page layout below ticket list
- Files added: src/components/QuickAddBar.tsx
- Files modified: src/lib/schemas.ts, src/lib/ticket-ui.ts, src/server/routers/tickets.ts, src/components/TicketFilter.tsx, src/components/AddTicketForm.tsx, src/components/TicketList.tsx, src/app/project/[path]/page.tsx
- Verified: `pnpm check` passes (all 186 tests pass)

## Ticket #45: Configurable command buttons
- Created src/lib/project-config.ts with Zod schema for command configuration
  - CommandConfigSchema: { label: string, cmd: string, icon?: string, destructive?: boolean }
  - ProjectConfigSchema: { commands: CommandConfig[] }
  - Default config: ralph-once ("Run Next") + ralph ("Run All") commands
- Updated src/server/routers/config.ts with config.get procedure
  - Reads .ralph-watch.json from project root (ralphDir)
  - Returns parsed config or defaults if file missing/invalid
- Updated RalphSidePanel to use dynamic command buttons from config
  - Fetches config via tRPC config.get query
  - Renders buttons dynamically from config.commands
  - Icon mapping for lucide-react icons (play, zap, hammer, terminal, etc.)
  - Confirmation dialog for destructive commands
- Updated RalphSidePanel.test.tsx to mock config.get query
- Files added: src/lib/project-config.ts
- Files modified: src/server/routers/config.ts, src/components/RalphSidePanel.tsx, src/components/RalphSidePanel.test.tsx
- Verified: `pnpm check` passes (all 186 tests pass)

## Ticket #46: Mobile-responsive UI
- Created src/hooks/use-media-query.ts with useMediaQuery and useIsMobile hooks
  - Uses useSyncExternalStore for SSR-safe media query detection
  - Returns false during SSR to avoid hydration mismatch
- Created src/components/BottomTabBar.tsx
  - Three tabs: Tickets, Progress, Run
  - Fixed to bottom with 64px height for touch targets
  - Active tab indicator and running process indicator on Run tab
  - Hidden on md+ breakpoint (desktop)
- Created src/components/MobileLayout.tsx
  - Full mobile experience managing tab state
  - Tickets tab: filter, ticket list, ticket detail, quick-add
  - Progress tab: progress.txt viewer
  - Run tab: command buttons, stop button, process output viewer
  - Reuses process management logic from RalphSidePanel
- Updated src/app/project/[path]/page.tsx
  - Uses useIsMobile hook to detect viewport size
  - Renders MobileLayout on mobile (<768px)
  - Renders desktop layout with RalphSidePanel on desktop
  - Renamed MobileTabs to DesktopTabs (for medium screens only)
- Touch-friendly adjustments
  - TicketList: min-height 56px, larger padding, active state styling
  - TicketFilter: min-height 36px on mobile, active state
  - QuickAddBar: height 44px on mobile, larger icons
- Files added: src/hooks/use-media-query.ts, src/components/BottomTabBar.tsx, src/components/MobileLayout.tsx
- Files modified: src/app/project/[path]/page.tsx, src/components/TicketList.tsx, src/components/TicketFilter.tsx, src/components/QuickAddBar.tsx
- Verified: `pnpm check` passes (all 186 tests pass)

## Ticket #47: Fix process output loss on tab switch
- Fixed bug where process output was lost when browser tab was backgrounded
- Root cause: SSE disconnects when tab is backgrounded, output goes to server buffer, but wasn't replayed on reconnect
- Added getOutput(id) method to ProcessRunner interface and implementation
  - Returns copy of buffered output lines for a process
  - Returns empty array if process not found
- Updated /api/events SSE endpoint to replay buffered output on subscription
  - Sends 'replay-start' event before replayed output
  - Sends buffered lines as 'output' events
  - Sends 'replay-end' event after replay
  - Uses timestamp deduplication to avoid re-sending already-sent lines
- Updated use-event-stream hook with onProcessReplayStart callback
- Updated RalphSidePanel to handle replay-start by clearing lines
- Added sessionStorage persistence for process output
  - Persists lines to sessionStorage on each update
  - Restores from sessionStorage when process ID reconnects
  - Clears on new process start
- Created src/hooks/use-visibility.ts for document visibility detection
- Added visibility-aware reconnection to use-event-stream
  - When tab becomes visible and disconnected, reconnects immediately (no 3s delay)
  - Uses reconnectTrigger state to force effect re-run
- Added tests for getOutput method in process-runner.test.ts
- Files added: src/hooks/use-visibility.ts
- Files modified: src/lib/process-runner.ts, src/server/services/process-runner.ts, src/server/services/process-runner.test.ts, src/app/api/events/route.ts, src/hooks/use-event-stream.ts, src/components/RalphSidePanel.tsx, src/server/routers/process.test.ts
- Verified: `pnpm check` passes (all 190 tests pass)
## Ticket #48: Move quick add input above ticket list in desktop mode
- Moved QuickAddBar from bottom of ticket list section to above it in desktop layout
- QuickAddBar now appears first, followed by TicketFilter, then TicketList
- Removed border-t styling since it's no longer a bottom section divider
- Files modified: src/app/project/[path]/page.tsx
- Verified: `pnpm check` passes (all 190 tests pass)
## Ticket #50: Fix quick add text not passed to detailed form
- Bug: when typing in quick add field and clicking expand, the text wasn't passed to AddTicketForm
- Root cause: AddTicketForm had its own internal title state initialized to empty string
- Fix: Added defaultTitle prop to AddTicketForm, initializes title state with it
- Added expandedTitle state to QuickAddBar to capture title before expand
- handleExpand callback: saves title to expandedTitle, clears quick add input, expands form
- Passes expandedTitle to AddTicketForm when rendering expanded view
- Created src/components/QuickAddBar.test.tsx with 7 tests
- Tests verify: input rendering, draft/pending creation, form expansion, title prefilling
- Files modified: src/components/AddTicketForm.tsx, src/components/QuickAddBar.tsx
- Files added: src/components/QuickAddBar.test.tsx
- Verified: `pnpm check` passes (all 197 tests pass)

## Ticket #49: Add dark mode configuration with system-default setting
- Created src/hooks/use-theme.ts with theme management hook
  - Theme options: 'light', 'dark', 'system' (respects prefers-color-scheme)
  - Persists to localStorage under 'ralph-watch-theme' key
  - Uses useSyncExternalStore for SSR-safe state management
  - Listens to system theme changes when in 'system' mode
- Created src/components/ThemeToggle.tsx dropdown component
  - Uses shadcn dropdown-menu for selection UI
  - Shows sun/moon icon based on resolved theme
  - Options: Light, Dark, System with icons
- Added inline script to src/app/layout.tsx for FOUC prevention
  - Applies .dark class before React hydrates based on stored/system preference
  - Uses suppressHydrationWarning on html element
- Added ThemeToggle to both pages (project picker and project view)
- Files added: src/hooks/use-theme.ts, src/components/ThemeToggle.tsx, src/components/ui/dropdown-menu.tsx
- Files modified: src/app/layout.tsx, src/app/page.tsx, src/app/project/[path]/page.tsx
- Verified: `pnpm check` passes (all 197 tests pass)

## Ticket #51: Configure colour schemes to follow Catppuccin styles
- Updated src/app/globals.css with Catppuccin color palette
- Light theme: Catppuccin Latte
  - background: Base (220 23% 95%)
  - foreground: Text (234 16% 35%)
  - card/popover: Mantle (220 22% 92%)
  - primary: Blue (220 91% 54%)
  - secondary/muted: Surface0 (223 16% 83%)
  - accent: Mauve (266 85% 58%)
  - destructive: Red (347 87% 44%)
  - border: Surface1 (225 14% 77%)
  - ring: Lavender (231 97% 72%)
- Dark theme: Catppuccin Mocha
  - background: Base (240 21% 15%)
  - foreground: Text (226 64% 88%)
  - card/popover: Mantle (240 21% 12%)
  - primary: Blue (217 92% 76%)
  - secondary/muted: Surface0 (237 16% 23%)
  - accent: Mauve (267 84% 81%)
  - destructive: Red (343 81% 75%)
  - border: Surface1 (234 13% 31%)
  - ring: Lavender (232 97% 85%)
- Chart colors updated to use Catppuccin accent colors (Red, Teal, Blue, Yellow, Mauve)
- Files modified: src/app/globals.css
- Verified: `pnpm check` passes (all 197 tests pass)

## Ticket #52: Refactor RalphSidePanel to state machine + server reconciliation
- Created src/lib/process-state.ts with state machine for process lifecycle
  - ProcessState: discriminated union (idle | starting | running | completed)
  - ProcessAction: all possible transitions (START, STARTED, OUTPUT, EXIT, ERROR, RESET, RECONCILE, etc.)
  - processReducer: pure function handling all state transitions, invalid actions are no-ops
  - Type guards: isIdle(), isStarting(), isProcessRunning(), isCompleted()
  - Helper functions: getProcessId(), getLines()
- Created src/lib/process-state.test.ts with 28 unit tests
  - Tests for all valid state transitions
  - Tests for invalid transition handling (no-ops)
  - Tests for type guards and helper functions
  - Tests for rapid state change sequences
- Added onReconnect callback to useEventStream hook
  - Tracks first connection via hasConnectedBeforeRef
  - Calls onReconnect on subsequent connections (reconnections)
- Refactored RalphSidePanel to use useReducer with state machine
  - Replaced multiple useState hooks with single useReducer(processReducer, initialProcessState)
  - SSE events dispatch actions to reducer
  - UI state derived from reducer state via type guards and helpers
- Implemented server reconciliation on reconnect
  - On reconnect, queries trpc.process.status for current server state
  - Dispatches RECONCILE action if server shows process exited/not_found
  - Handles edge case where SSE disconnects during process exit
- Updated RalphSidePanel.test.tsx to mock process.status.useQuery
- Benefits achieved:
  - Single source of truth (the reducer state)
  - Impossible states are impossible (discriminated union)
  - All transitions explicit and testable
  - Server reconciliation handles SSE disconnect edge cases
  - No fragile useEffect coordination
- Files added: src/lib/process-state.ts, src/lib/process-state.test.ts
- Files modified: src/hooks/use-event-stream.ts, src/components/RalphSidePanel.tsx, src/components/RalphSidePanel.test.tsx
- Verified: `pnpm check` passes (all 225 tests pass)
## Ticket #53: use streamdown library to display description block in main pane, not in ticket view
- Installed streamdown (1.6.11) and @tailwindcss/typography for markdown support
- Created src/components/DescriptionViewer.tsx wrapping streamdown's Streamdown component
- Added streamdown dist folder to tailwind.config.ts content paths
- Added tailwindTypography plugin to tailwind.config.ts
- Updated DetailPanel in src/app/project/[path]/page.tsx to use DescriptionViewer
- Updated MobileTicketDetail in src/components/MobileLayout.tsx to use DescriptionViewer
- Removed description display from TicketList.tsx (ticket view) - descriptions now only shown in main detail pane
- Files added: src/components/DescriptionViewer.tsx
- Files modified: package.json, tailwind.config.ts, src/app/project/[path]/page.tsx, src/components/MobileLayout.tsx, src/components/TicketList.tsx
- Verified: `pnpm check` passes (all 225 tests pass)

## Ticket #54: add a new "Incomplete" tab that displays draft, pending, and In Progress tickets, and make that the default
- Added 'incomplete' to TicketStatus type in src/components/TicketFilter.tsx
- Added Incomplete option to STATUS_OPTIONS (placed first in list for prominence)
- Updated isValidTicketStatus to recognize 'incomplete' as valid status
- Updated TicketList filtering logic to handle 'incomplete' filter
  - Returns tickets where status is 'draft', 'pending', or 'in_progress'
- Changed default filter from 'all' to 'incomplete' in useTicketFilter hook
- URL param logic updated: 'incomplete' is omitted from URL (default), others are included
- Files modified: src/components/TicketFilter.tsx, src/components/TicketList.tsx, src/hooks/use-ticket-filter.ts
- Verified: `pnpm check` passes (all 225 tests pass)

## Ticket #55: use streamdown on the progress log display
- Updated ProgressViewer to use Streamdown component for markdown rendering
- Replaced pre element with div containing Streamdown, wrapping progress.txt content
- Added prose/prose-sm/dark:prose-invert classes for proper markdown styling
- Changed contentRef from HTMLPreElement to HTMLDivElement
- Separated empty content case from loading/error handling for cleaner code
- Files modified: src/components/ProgressViewer.tsx
- Verified: `pnpm check` passes (all 225 tests pass)

## Ticket #56: fix selected tab styling
- Fixed ticket card selection border being clipped by ScrollArea overflow-hidden
- Changed ring-2 ring-primary to ring-2 ring-inset ring-primary in TicketList.tsx
- ring-inset renders the ring inside the element instead of outside, avoiding clipping
- Files modified: src/components/TicketList.tsx
- Verified: `pnpm check` passes (all 225 tests pass)


## Ticket #57: add a ralph control button to follow an existing ralph instance
- Added ATTACH action to process state machine in src/lib/process-state.ts
- ATTACH transitions from idle or completed to running state with provided process id/pid
- Added trpc.process.list.useQuery to RalphSidePanel to poll for running processes (5s interval)
- Added Follow dropdown button that lists running processes by PID
- When user selects a process, UI attaches to its output stream via useEventStream
- Added Radio icon import from lucide-react for Follow button
- Added DropdownMenu components import for process selection
- Added unit tests for ATTACH action in both idle and completed states
- Updated RalphSidePanel.test.tsx to mock process.list.useQuery
- Files modified: src/lib/process-state.ts, src/lib/process-state.test.ts, src/components/RalphSidePanel.tsx, src/components/RalphSidePanel.test.tsx
- Verified: `pnpm check` passes (all 227 tests pass)

## Ticket #58: Move progress log to dedicated page/tab with scroll buttons
- Created dedicated progress page at src/app/project/[path]/progress/page.tsx
- Added floating scroll-to-top and scroll-to-bottom buttons to ProgressViewer component
  - Buttons appear in bottom-right corner when scrolling is possible
  - Scroll-to-top button: hidden when at top, visible when scrolled down
  - Scroll-to-bottom button: hidden when at bottom, visible when scrolled up
  - Smooth scrolling animation for both directions
  - Buttons use secondary variant with shadow and rounded-full styling
- Added showScrollButtons prop to ProgressViewer (default false)
- Progress page features:
  - Full-height viewer with scroll buttons enabled
  - Back to Tickets navigation button
  - Header with project name and path
  - Theme toggle and connection status indicator
- Added Progress Log button to main project page header (desktop)
  - Uses FileText icon from lucide-react
  - Links to /project/[encodedPath]/progress
- Removed embedded ProgressViewer from DetailPanel
  - Progress now accessed via dedicated page instead of inline card
- Used queueMicrotask pattern to satisfy ESLint set-state-in-effect rule for scroll position detection
- Files added: src/app/project/[path]/progress/page.tsx
- Files modified: src/components/ProgressViewer.tsx, src/app/project/[path]/page.tsx
- Verified: `pnpm check` passes (all 227 tests pass)

## Ticket #59: fix: make incomplete tab the default one
- Bug: Desktop and mobile layouts used useState with 'all' as default filter
- Root cause: useTicketFilter hook had correct 'incomplete' default but components didn't use hook
- Fix: Changed default from 'all' to 'incomplete' in both DesktopProjectContent and MobileLayout
- Files modified: src/app/project/[path]/page.tsx, src/components/MobileLayout.tsx
- Verified: `pnpm check` passes (all 227 tests pass)

## Ticket #60: Embedded Claude Code terminal via xterm.js
- Added node-pty, ws, @xterm/xterm, @xterm/addon-fit, @xterm/addon-web-links dependencies
- Created src/server/services/terminal-server.ts - WebSocket server with PTY management
  - Localhost-only security by default (127.0.0.1, ::1, ::ffff:127.0.0.1)
  - Remote access requires RALPH_ENABLE_REMOTE_TERMINAL=yes-i-understand-this-is-dangerous
  - Spawns `claude` via node-pty with xterm-256color support
  - Handles input, resize, and cleanup on disconnect
- Created scripts/terminal-server.ts - standalone entry point for WebSocket server
- Created src/hooks/use-terminal.ts - WebSocket connection hook
  - Manages connection state, sends input/resize messages
  - Callbacks for output, ready, exit, error events
- Created src/components/Terminal.tsx - xterm.js wrapper component
  - Initializes Terminal with FitAddon and WebLinksAddon
  - Catppuccin-themed colors matching app theme
  - Connect/Disconnect buttons and status indicator
  - Handles resize with ResizeObserver
- Updated src/components/RalphSidePanel.tsx with tab navigation
  - Added Output and Terminal tabs below command buttons
  - Terminal tab shows embedded Claude terminal
  - Renamed Terminal icon import to TerminalIcon to avoid conflict
- Updated package.json with `terminal` script to run WebSocket server via tsx
- Updated README.md with terminal usage and security warning
- Updated .env.example with TERMINAL_WS_PORT and RALPH_ENABLE_REMOTE_TERMINAL docs
- Added @xterm/xterm CSS import to globals.css
- Fixed test flakes in process-state.test.ts (timestamp comparison)
- Fixed RalphSidePanel.test.tsx for new tab UI
- Files added: scripts/terminal-server.ts, src/server/services/terminal-server.ts, src/hooks/use-terminal.ts, src/components/Terminal.tsx
- Files modified: package.json, README.md, .env.example, src/app/globals.css, src/components/RalphSidePanel.tsx, src/components/RalphSidePanel.test.tsx, src/lib/process-state.test.ts
- Verified: `pnpm check` passes (all 227 tests pass)


## Ticket #61: Terminal UX: bottom pane + auto-start server
- Installed concurrently to run Next.js and terminal server together
- Updated dev script: `concurrently -n next,term -c blue,green "next dev" "tsx scripts/terminal-server.ts"`
- Created BottomTerminalPane component with resizable height via drag handle
- Added keyboard shortcut Cmd/Ctrl+` to toggle terminal visibility
- Added TerminalToggleButton in header for easy toggle access
- Moved terminal from side panel tab to dedicated bottom pane
- Removed terminal tab from RalphSidePanel (now shows output only)
- Terminal height and visibility state persisted in localStorage
- Uses useSyncExternalStore for cross-component visibility sync
- Files changed: package.json, src/components/BottomTerminalPane.tsx (new), src/app/project/[path]/page.tsx, src/components/RalphSidePanel.tsx, src/components/RalphSidePanel.test.tsx
- Tests: all 227 tests pass
## Ticket #62: Add ralph-stop action + terminal reconnect button
- Added ralph-stop to default commands in src/lib/project-config.ts
  - Uses 'square' icon, marked as destructive: true (shows confirmation dialog)
- Implemented auto-reconnect with exponential backoff in use-terminal.ts hook
  - Reconnect attempts up to 10 times (configurable via maxReconnectAttempts)
  - Delays: 1s, 2s, 4s, 8s... up to 30s max
  - Tracks reconnectAttempt state for UI display
  - Uses doConnectRef pattern to avoid circular dependency with useCallback
  - Stops auto-reconnect when user manually disconnects
- Updated Terminal.tsx component
  - Shows reconnection status: "Reconnecting (attempt N)..."
  - Yellow terminal message on each reconnection attempt
  - Button changes from "Connect" to "Retry" after error state
  - Status display refactored to getStatusText() helper
- Files modified: src/lib/project-config.ts, src/hooks/use-terminal.ts, src/components/Terminal.tsx
- Verified: `pnpm check` passes (all 227 tests pass)

## Ticket #63: append ticket id to route to preserve selection
- Created src/hooks/use-selected-ticket.ts hook for URL-based selection state
- Hook uses ?ticket=N query param to store selected ticket ID
- Updated DesktopProjectContent to use useSelectedTicket() instead of useState
- Updated MobileLayout to use useSelectedTicket() instead of useState
- showTicketDetail in mobile now derived from selectedTicketId !== null
- Selection now survives page refresh and can be bookmarked/shared
- Files added: src/hooks/use-selected-ticket.ts
- Files modified: src/app/project/[path]/page.tsx, src/components/MobileLayout.tsx
- Verified: `pnpm check` passes (all 227 tests pass)

## Ticket #64: Fix terminal pane layout - use fixed positioning
- Bug: Terminal pane could be pushed off-screen when content above it was tall
- Root cause: BottomTerminalPane was in document flow, not fixed to viewport
- Fix: Changed visible terminal pane to use fixed positioning at viewport bottom
- Added z-40 for proper stacking above content
- Exported useTerminalHeight() hook to get current terminal height
- Updated HomeContent in project page to add dynamic padding-bottom based on terminal height
- When terminal is visible, content area shrinks by terminal height to prevent overlap
- When terminal is hidden, content area uses full height
- Also fixed pre-existing prettier error in scripts/terminal-server.ts
- Files modified: src/components/BottomTerminalPane.tsx, src/app/project/[path]/page.tsx, scripts/terminal-server.ts
- Verified: pnpm check passes (all 227 tests pass)

## Ticket #67: Fix terminal toggle shortcut for Linux
- Problem: Cmd+` doesn't work on Linux with Windows keyboards (no Cmd key)
- Keyboard handler already used (e.metaKey || e.ctrlKey), so shortcut worked
- But tooltip text was hardcoded "Cmd+`" which was misleading on Linux/Windows
- Fix: Added platform detection using navigator.platform
- Uses useSyncExternalStore for SSR-safe platform detection (returns Ctrl+` on server, then updates)
- isMac check: navigator.platform.toUpperCase().indexOf('MAC') >= 0
- macOS shows "Cmd+`", Linux/Windows shows "Ctrl+`"
- Updated all three tooltip locations: floating button, header bar hint, TerminalToggleButton
- Files modified: src/components/BottomTerminalPane.tsx
- Verified: pnpm check passes (all 227 tests pass)

## Ticket #66: Move terminal to right side pane
- Moved terminal from bottom pane to right side pane for better Claude Code experience
- Created src/components/RightTerminalPane.tsx with horizontal resizing
  - Uses width instead of height (default 600px, min 300px, max 70vw)
  - Drag handle on left edge for resizing
  - Same keyboard shortcut support (Cmd/Ctrl+`)
  - Fixed positioning at viewport right
  - Width persisted to localStorage
- Updated src/app/project/[path]/page.tsx
  - Replaced BottomTerminalPane with RightTerminalPane
  - Changed from paddingBottom to paddingRight for main content
  - Imports updated: useTerminalHeight → useTerminalWidth
- Deleted src/components/BottomTerminalPane.tsx
- Layout: main app content gets left portion, terminal takes right side
- Files added: src/components/RightTerminalPane.tsx
- Files modified: src/app/project/[path]/page.tsx
- Files deleted: src/components/BottomTerminalPane.tsx
- Verified: pnpm check passes (all 227 tests pass)

## Ticket #68: Give ticket status badge semantic colours
- Replaced hardcoded Tailwind colors (bg-yellow-500/20, text-blue-700, etc.) with CSS variables
- Added semantic status colors to globals.css for Catppuccin Latte (light) theme:
  - --status-draft: muted gray (Overlay0)
  - --status-pending: yellow (Yellow)
  - --status-in-progress: blue (Blue)
  - --status-completed: green (Green)
  - --status-failed: red (Red)
- Added matching semantic status colors for Catppuccin Mocha (dark) theme
- Updated getStatusBadgeClass() in src/lib/ticket-ui.ts to use CSS variables via hsl() syntax
- Badge color logic is centralized in ticket-ui.ts - used by TicketList, DetailPanel, and MobileLayout
- Files modified: src/app/globals.css, src/lib/ticket-ui.ts
- Verified: pnpm check passes (all 227 tests pass)

## Ticket #65: Make terminal font configurable / use better default
- Updated xterm.js fontFamily config in src/components/Terminal.tsx
- Changed from 'Menlo, Monaco, "Courier New", monospace' to improved font stack
- New font stack: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace'
- ui-monospace lets OS/browser pick best system monospace font
- SFMono-Regular for macOS, Consolas for Windows, fallback to Menlo/Monaco
- Files modified: src/components/Terminal.tsx
- Verified: pnpm check passes (all 227 tests pass)

## Ticket #69: Make the ralph control pane and the ticket sidebars resizable
- Created src/hooks/use-resizable-panel.ts with reusable hook for panel resizing
  - Uses useSyncExternalStore for SSR-safe state management
  - Persists panel width and collapsed state to localStorage
  - Module-level store pattern for shared state across components
  - Supports min/max width constraints and collapsed state
- Created src/components/ResizableHandle.tsx as reusable drag handle component
  - Works with left or right edge dragging
  - Visual feedback on hover/drag
  - Handles mouse events for resize interaction
- Updated src/app/project/[path]/page.tsx (ticket sidebar)
  - Ticket sidebar now resizable from right edge (250-600px, default 400px)
  - Width persisted in localStorage under 'ralph-ticket-sidebar-width'
  - Handle only visible on lg+ breakpoint (desktop)
- Updated src/components/RalphSidePanel.tsx (ralph control pane)
  - Ralph control pane resizable from left edge (200-500px, default 350px)
  - Width persisted in localStorage under 'ralph-control-panel-width'
  - Collapsed state also persisted (48px collapsed width)
- Files added: src/hooks/use-resizable-panel.ts, src/components/ResizableHandle.tsx
- Files modified: src/app/project/[path]/page.tsx, src/components/RalphSidePanel.tsx
- Verified: pnpm check passes (all 227 tests pass)


## Status sync: Ticket #68 status fix
- Ticket #68 was marked as pending in tickets.json but work was already completed
- Updated status from "pending" to "completed" to match progress.txt
- No pending tickets remaining in backlog

## Ticket #68: Give ticket status badge semantic colours (refix)
- Previous implementation used 20% opacity backgrounds which were too faint
- Updated CSS variables to use -bg/-fg suffix pattern for clarity
- Light theme (Latte): solid pastel backgrounds at ~75% lightness with dark text (~25-30% lightness)
- Dark theme (Mocha): solid darker backgrounds at ~30-35% lightness with light text (~85-90% lightness)
- getStatusBadgeClass() now uses solid background colors instead of transparent overlays
- Color logic centralized in ticket-ui.ts, used by TicketList, page.tsx DetailPanel, and MobileLayout
- Files modified: src/app/globals.css, src/lib/ticket-ui.ts
- Verified: pnpm check passes (all 227 tests pass)

## Ticket #70: Fix ralph controls sidepane resize bug
- Bug: RalphSidePanel resize handle didn't actually resize the panel
- Root cause: ResizableHandle used absolute viewport calculation (`window.innerWidth - e.clientX`)
- This assumed panel extends to viewport edge, but RightTerminalPane may occupy right side
- Fix: Changed to delta-based resizing in ResizableHandle.tsx
- On mousedown: capture starting clientX and current storedWidth
- On mousemove: calculate delta from start, apply to starting width
- For edge="left": newWidth = startWidth - deltaX (moving left increases width)
- For edge="right": newWidth = startWidth + deltaX (moving right increases width)
- This works regardless of panel position in viewport
- Files modified: src/components/ResizableHandle.tsx
- Verified: pnpm check passes (all 227 tests pass)

## Ticket #71: Mobile terminal support - add Terminal tab to bottom bar
- Added Terminal tab to bottom navigation bar for mobile access
- BottomTabBar already had Terminal tab defined, added isTerminalConnected indicator
- Updated MobileLayout to render Terminal component when terminal tab is active
- Created TerminalControls component with mobile-specific control buttons:
  - ^C (SIGINT), Tab, Esc, ↑, ↓ arrow keys
  - Touch-friendly button sizing (min 44px)
  - Disabled state when terminal not connected
- Added props to Terminal component:
  - showControls: boolean to show/hide mobile control buttons
  - onConnectionChange: callback to notify parent of connection state
- Terminal component now displays control bar at bottom when showControls is true
- Fixed naming conflict: imported Terminal as TerminalComponent in MobileLayout
- Files added: src/components/TerminalControls.tsx
- Files modified: src/components/Terminal.tsx, src/components/MobileLayout.tsx
- Verified: pnpm check passes (all 227 tests pass)
## Ticket #72: PWA support for mobile home screen install
- Created public/manifest.json with PWA configuration
  - App name: Ralph Watch, short name: Ralph
  - Display: standalone (no browser chrome)
  - Background and theme colors using Catppuccin Mocha base (#1e1e2e)
- Created app icons:
  - public/icon.svg with "R" letter on blue gradient (Catppuccin colors)
  - public/icon-192.png and public/icon-512.png as PNG fallbacks (solid blue)
  - scripts/generate-icons.mjs pure JS script for PNG generation
- Updated src/app/layout.tsx with PWA meta tags via Next.js metadata API:
  - manifest link
  - appleWebApp configuration (capable, statusBarStyle, title)
  - icons (SVG and apple-touch-icon)
  - mobile-web-app-capable meta tag
- Added viewport configuration with theme-color for light/dark modes
  - Light mode: #eff1f5 (Catppuccin Latte)
  - Dark mode: #1e1e2e (Catppuccin Mocha)
- Created public/sw.js minimal service worker for install prompt
  - No caching (dev tool needs live server connection)
  - skipWaiting and clients.claim for immediate activation
- Service worker registration in theme script (runs on client load)
- Files added: public/manifest.json, public/icon.svg, public/icon-192.png, public/icon-512.png, public/sw.js, scripts/generate-icons.mjs
- Files modified: src/app/layout.tsx
- Verified: pnpm check passes (all 227 tests pass)

## Ticket #74: Fix extended quick entry form on mobile - bottom cut off
- Fixed QuickAddBar expanded form being cut off on mobile due to overflow constraints
- Added `max-h-[50vh] md:max-h-none overflow-y-auto` to expanded form container
  - Limits form height to 50% viewport on mobile, making it scrollable
  - Desktop (md+) has no height limit
- Made header sticky within scroll container for consistent UX
- Updated MobileLayout.tsx ScrollArea to use `min-h-0` for proper flex shrinking
- Added test to verify expanded form has scrollable overflow classes
- Files changed: src/components/QuickAddBar.tsx, src/components/MobileLayout.tsx, src/components/QuickAddBar.test.tsx
- Verified: pnpm check passes (all 228 tests pass)

## Ticket #73: Add scroll to top and bottom buttons to mobile progress tab
- ProgressViewer already had showScrollButtons prop implemented (from ticket #58)
- Enabled scroll buttons in mobile progress tab by adding showScrollButtons prop to ProgressViewer in MobileLayout.tsx
- Files modified: src/components/MobileLayout.tsx
- Verified: pnpm check passes (all 228 tests pass)

## Ticket #75: Add Shift+Tab button to terminal control buttons
- Added S-Tab button to TerminalControls component
- Sends \x1b[Z escape sequence (standard reverse-tab/backtab)
- Placed between Tab and Esc buttons for logical grouping
- Label "S-Tab" with tooltip "Send Shift+Tab (reverse tab)"
- Files modified: src/components/TerminalControls.tsx
- Verified: pnpm check passes (all 228 tests pass)
